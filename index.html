<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Global Citizen</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel='stylesheet prefetch' href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css'>
    <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css'>
    <link rel='stylesheet' href='css/style.css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
    <script src="http://c.boylett.uk/libraries/Blob.js"></script>
    <script src="http://c.boylett.uk/libraries/canvas-toBlob.js"></script>
    <script src="http://c.boylett.uk/libraries/FileSaver.js"></script>
    <script src="http://c.boylett.uk/libraries/psd.min.js"></script>
	<script src="js/base64binary.js"></script>
  </head>
  <body>
    <header>
      <img src="./images/black_logo.png">
    </header>
    <div class="square blur img_1-1 8"></div>
    <div class="square img_1-2">
      <div class="first-phase">
        <p>Share Your Story</p>
        <p>with the World.</p>
        <!-- <img src="./images/black_camera.png"> -->
        <div class="get_started">
          <p>Get Started</p>
        </div>
      </div>
       <aside class="upload_magic">
        <div  class="second-phase">
          <div class="interaction-panel">
            <div class="carrot"></div>
            <form class="interaction-form" onsubmit="return jsMeme.file.export(), !1">
              <button>
                <img class="fr interaction-button-two" src="./images/icons/upload.svg">
              </button>
              <img onclick="shareOnFB();" class="fr interaction-button-three" src="./images/icons/share.svg">
              <img class="fr interaction-button-one" onclick="return jsMeme.reset(), !1" src="./images/icons/redo.svg">
            </form>
          </div>
        </div>
      <div class="third-phase">
          <!-- <main> -->
        <div class="canvas-container">
          <canvas></canvas>
        </div>
        <div class="not-ready">
          <button class="dark">
            <!-- Choose an image file to get started -->
            <input class="drag-and-drop" type="file" accept="image/*;capture=camera" onchange="jsMeme.file.import(this)" />
            <div class="drag-and-drop-overlay">
              <img src="./images/icons/white_camera.svg">
              <p class="drag-title">Drag Photo Here</p>
            </div>
          </button>

          <form class="main_input">
            <input id="first-input" type="text" placeholder="Artist."  name="line-1" />
            <input id="second-input" type="text" placeholder="Daughter." name="line-2" />
            <form id="example" name="example" value="" id="sensorText">
              <select id="sensor" onchange="updateText('sensor')">
                <option value="Immigrant.">Immigrant.</option>
                <option value="Refugee.">Refugee.</option>
              </select>
              <input id="third-input" type="hidden" placeholder="" name="line-3" />
              <img class="logo-stamp" src="./images/white_logo.png">
            </form>
          </form>
           
        </div>
      <!-- </main> -->

       
        <!-- <form onsubmit="return jsMeme.file.export(), !1">
          <button class="fr" onclick="return jsMeme.reset(), !1">Reset</button>
          <button class="blue">Download Image</button>
        </form> -->
      </aside>

   

    <!-- <img class="watermark" src="./images/white_logo.png"> -->
    

      </div>


    <!-- all the action happens here -->
    </div>
    <div class="square blur img_1-3 1"></div>
    <div class="square blur img_2-1 2"></div>
    <div class="square blur img_2-2 3"></div>
    <div class="square blur img_2-3 4"></div>
    <div class="square blur img_3-1 5"></div>
    <div class="square blur img_3-2 6"></div>
    <div class="square blur img_3-3 7"></div>
    <!-- <footer>
      
    </footer> -->
    <div id="bottom">
      <div class="float-left footer footer-1">
        <p>#thisis<span>america</span></p>
      </div>

      <div class="footer-nav footer footer-2">
        <ul>
          <li> Who We Are </li>
          <li> Contact Us </li>
          <li> Impact </li>
        </ul>
      </div>
      
      <div class="footer-image footer footer-3">
        <img src="./images/white_logo_stacked.png">
      </div>
    </div>


    <!-- <aside>
      <div class="drop">
        Drop an image file here
        <span>Accepted: JP(E)G, PNG, GIF, BMP, PSD</span>
        <input type="file" accept="image/*;capture=camera" onchange="jsMeme.file.import(this)" />
      </div>
      <button onclick="return jsMeme.file.rotate(-90), !1"><i class="fa fa-rotate-left"></i></button>
      <button onclick="return jsMeme.file.rotate(90), !1"><i class="fa fa-rotate-right"></i></button>
      <form>
        <h2>
          Occupation:
        </h2>
        <input id="first-input" type="text" placeholder="Type your first line..."  name="line-1" />
        <h2>
          Passion:
        </h2>
        <input id="second-input" type="text" placeholder="Type your second line..." name="line-2" />
        <form id="example" name="example" value="" id="sensorText">
          <select id="sensor" onchange="updateText('sensor')">
            <option value="IMMIGRANT">Immigrant</option>
            <option value="REFUGEE">Refugee</option>
          </select>
          <input id="third-input" type="hidden" placeholder="" name="line-3" />
        </form>
        <label><input type="text" size="14" placeholder="Image Size..." value="550" name="maximum-width" class="slider" min="200" max="1024" /> <em>Width: <span name="img-width">550px</span></em>
        </label>
      </form>
      <form onsubmit="return jsMeme.file.export(), !1">
        <button class="fr" onclick="return jsMeme.reset(), !1">Reset</button>
        <button class="blue">Download Image</button>
      </form>
    </aside>
    <main>
      <div class="canvas-container">
        <canvas></canvas>
      </div>
      <div class="not-ready">
        <button class="dark">
          Choose an image file to get started
          <input type="file" accept="image/*;capture=camera" onchange="jsMeme.file.import(this)" />
        </button>
      </div>
    </main> -->
    <script>
	
		if ( XMLHttpRequest.prototype.sendAsBinary === undefined ) {
		    XMLHttpRequest.prototype.sendAsBinary = function(string) {
		        var bytes = Array.prototype.map.call(string, function(c) {
		            return c.charCodeAt(0) & 0xff;
		        });
		        this.send(new Uint8Array(bytes).buffer);
		    };
		};
		
		(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/all.js";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		
		window.fbAsyncInit = function() {
		    FB.init({
		      appId  : "1949853321909796",
		      status : true,
		      cookie : true,
		      xfbml  : true  
		    });
		};
		
		var postImageToFacebook = function(authToken,filename,mimeType,imageData,message) {

		    var boundary = '----ASDFJKDSFJDSKFEQ#$3reqds341dfdsac34343';
	
		    var formData = '--' + boundary + '\r\n'
		    formData += 'Content-Disposition: form-data; name="source"; filename="' + filename + '"\r\n';
		    formData += 'Content-Type: ' + mimeType + '\r\n\r\n';
		    for ( var i = 0; i < imageData.length; ++i )
		    {
		        formData += String.fromCharCode( imageData[ i ] & 0xff );
		    }
		    formData += '\r\n';
		    formData += '--' + boundary + '\r\n';
		    formData += 'Content-Disposition: form-data; name="message"\r\n\r\n';
		    formData += message + '\r\n'
		    formData += '--' + boundary + '--\r\n';
		    var xhr = new XMLHttpRequest();
		    xhr.open( 'POST', 'https://graph.facebook.com/me/photos?access_token=' + authToken, true );
		    xhr.onload = xhr.onerror = function() {
		        console.log( xhr.responseText );
		    };
		    xhr.setRequestHeader( "Content-Type", "multipart/form-data; boundary=" + boundary );
		    xhr.sendAsBinary( formData );
		};
		
		
		
      var shareOnFB = function() {
		  var data = jsMeme.canvas.toDataURL("image/png");
		  	var encodedPng = data.substring(data.indexOf(',') + 1, data.length);
		  	var decodedPng = Base64Binary.decode(encodedPng);
		  	FB.getLoginStatus(function(response) {
		  	  if (response.status === "connected") {
		  		postImageToFacebook(response.authResponse.accessToken, "this-is-america", "image/png", decodedPng, "www.this-is-america.com");
		  	  } else if (response.status === "not_authorized") {
		  		 FB.login(function(response) {
		  			postImageToFacebook(response.authResponse.accessToken, "this-is-america", "image/png", decodedPng, "www.this-is-america.com");
		  		 }, {scope: "publish_actions"});
		  	  } else {
		  		 FB.login(function(response)  {
		  			postImageToFacebook(response.authResponse.accessToken, "this-is-america", "image/png", decodedPng, "www.this-is-america.com");
		  		 }, {scope: "publish_actions"});
		  	  }
		  	 });
		 };

    </script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'></script>
    <script src="js/index.js"></script>
  </body>
</html>
